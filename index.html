<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RK KNIT FAB â€“ Dyeing Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>

body {
  margin: 0;
  padding: 12px;
  font-family: 'Poppins', sans-serif;
  background: #f6f7fb;
}

/* Title */
h2 {
  text-align: center;
  font-size: 20px;
  margin-bottom: 10px;
}

/* Filters */
.filters {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.filters input {
  flex: 1;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
}

/* CARD LIST VIEW (FASTEST FOR MOBILE) */
.card {
  background: white;
  padding: 14px;
  margin-bottom: 10px;
  border-radius: 12px;
  font-size: 14px;
}

/* Top row (Lot + Status) */
.card-head {
  display: flex;
  justify-content: space-between;
  font-weight: 600;
  margin-bottom: 6px;
}

/* Done button */
button {
  padding: 6px 10px;
  background: #28a745;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 13px;
}

/* Fade out animation */
.fade-out {
  animation: fadeOut 0.4s forwards ease-out;
}

@keyframes fadeOut {
  from { opacity: 1; transform: scale(1); }
  to { opacity: 0; transform: scale(0.95); height: 0; margin: 0; }
}

/* DESKTOP MODE (SHOW TABLE) */
@media (min-width: 700px) {

  .card { display: none; } /* hide cards on desktop */

  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 10px;
    overflow: hidden;
  }

  th, td {
    padding: 10px;
    border-bottom: 1px solid #eee;
    text-align: center;
  }

  th {
    background: #e9eef5;
  }

  #desktopTable { display: block; }
}

</style>
</head>

<body>

<h2>Dyeing Pending Lots</h2>

<div class="filters">
  <input id="searchLot" placeholder="Search Lot">
  <input id="filterParty" placeholder="Filter Party">
  <input id="filterColor" placeholder="Filter Color">
</div>

<div id="listView"></div>
<div id="desktopTable"></div>

<script>

const API = "https://script.google.com/macros/s/AKfycbz7Ggy8e_NA6Wg6R5QMxP22hjDf6esMiXN-UOn_1NwzuXNDM1kTjwmycfCvZ9JqT5pH/exec";
let fullData = [];

// LOAD DATA
async function loadData() {
  const res = await fetch(API);
  fullData = await res.json();
  render();
}

// SAFE FILTER STRING
function safe(v) {
  return String(v || "").toLowerCase();
}

// RENDER BOTH LIST + TABLE
function render() {

  const fLot = safe(document.getElementById("searchLot").value);
  const fParty = safe(document.getElementById("filterParty").value);
  const fColor = safe(document.getElementById("filterColor").value);

  const filtered = fullData.filter(r =>
    safe(r.lot).includes(fLot) &&
    safe(r.party).includes(fParty) &&
    safe(r.color).includes(fColor)
  );

  // ---------- MOBILE CARD VIEW ----------
  let cards = "";
  filtered.forEach(r => {
    cards += `
      <div class="card" id="card-${r.lot}">
        <div class="card-head">
          <span>${r.lot}</span>
          <button onclick="markDone('${r.lot}')">Done</button>
        </div>
        <div><b>Item:</b> ${r.item}</div>
        <div><b>Color:</b> ${r.color}</div>
        <div><b>Party:</b> ${r.party}</div>
        <div><b>Date:</b> ${r.date}</div>
      </div>
    `;
  });
  document.getElementById("listView").innerHTML = cards;

  // ---------- DESKTOP TABLE ----------
  let table = `
    <table>
      <tr>
        <th>Date</th><th>Lot</th><th>Item</th>
        <th>Color</th><th>Party</th>
        <th>Status</th><th>Done</th>
      </tr>
  `;
  filtered.forEach(r => {
    table += `
      <tr id="row-${r.lot}">
        <td>${r.date}</td>
        <td>${r.lot}</td>
        <td>${r.item}</td>
        <td>${r.color}</td>
        <td>${r.party}</td>
        <td>${r.status}</td>
        <td><button onclick="markDone('${r.lot}')">Done</button></td>
      </tr>
    `;
  });
  table += "</table>";

  document.getElementById("desktopTable").innerHTML = table;
}

// DONE ACTION
async function markDone(lot) {

  const c = document.getElementById("card-" + lot);
  const r = document.getElementById("row-" + lot);

  if (c) c.classList.add("fade-out");
  if (r) r.classList.add("fade-out");

  await fetch(`${API}?action=done&lot=${lot}`);

  setTimeout(loadData, 450);
}

// Filter Events
searchLot.oninput = render;
filterParty.oninput = render;
filterColor.oninput = render;

loadData();

</script>

</body>
</html>
