<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RK KNIT FAB â€“ Dyeing Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>

body {
  margin: 0;
  padding: 15px;
  font-family: Poppins, sans-serif;
  background: #f2f5f9;
}

h2 {
  text-align: center;
  margin-bottom: 15px;
}

/* FILTER BAR */
.filters {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 15px;
}

.filters input {
  flex: 1;
  min-width: 120px;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #ddd;
}

/* TABLE */
table {
  width: 100%;
  border-collapse: collapse;
  background: white;
  border-radius: 10px;
  overflow: hidden;
}

th, td {
  padding: 10px;
  text-align: center;
  border-bottom: 1px solid #eee;
}

th {
  background: #f0f3f7;
  font-weight: 600;
}

/* DONE BUTTON */
button {
  padding: 6px 12px;
  border: none;
  background: #28a745;
  color: white;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
}
button:hover {
  background: #1e7e34;
}

/* ROW DELETE ANIMATION */
.fade-out {
  animation: fadeOut 0.4s forwards ease-out;
}
@keyframes fadeOut {
  from { opacity: 1; transform: scale(1); }
  to { opacity: 0; transform: scale(0.95); height: 0; }
}

/* PHONE OPTIMIZATION */
@media (max-width: 600px) {
  table, th, td {
    font-size: 13px;
    padding: 6px;
  }
}

</style>
</head>

<body>

<h2>Dyeing Pending Lots</h2>

<!-- FILTERS -->
<div class="filters">
  <input type="text" id="searchLot" placeholder="Search Lot">
  <input type="text" id="filterParty" placeholder="Filter Party">
  <input type="text" id="filterColor" placeholder="Filter Color">
</div>

<div id="dataArea">Loading...</div>

<script>

const API = "https://script.google.com/macros/s/AKfycbz7Ggy8e_NA6Wg6R5QMxP22hjDf6esMiXN-UOn_1NwzuXNDM1kTjwmycfCvZ9JqT5pH/exec";   // <-- Replace this

let fullData = [];

// LOAD DATA FROM GAS
async function loadData() {
  const res = await fetch(API);
  fullData = await res.json();
  renderTable(fullData);
}

// RENDER TABLE
function renderTable(data) {

  const search = document.getElementById("searchLot").value.toLowerCase();
  const party = document.getElementById("filterParty").value.toLowerCase();
  const color = document.getElementById("filterColor").value.toLowerCase();

  const filtered = data.filter(r => 
    String(r.lot || "").toLowerCase().includes(search) &&
    String(r.party || "").toLowerCase().includes(party) &&
    String(r.color || "").toLowerCase().includes(color)
  );

  let html = `
  <table>
    <tr>
      <th>Date</th>
      <th>Lot</th>
      <th>Item</th>
      <th>Color</th>
      <th>Party</th>
      <th>Status</th>
      <th>Done</th>
    </tr>
  `;

  filtered.forEach(r => {
    html += `
      <tr id="row-${r.lot}">
        <td>${r.date}</td>
        <td>${r.lot}</td>
        <td>${r.item}</td>
        <td>${r.color}</td>
        <td>${r.party}</td>
        <td>${r.status}</td>
        <td><button onclick="markDone('${r.lot}')">Done</button></td>
      </tr>
    `;
  });

  html += "</table>";
  document.getElementById("dataArea").innerHTML = html;
}

// MARK DONE
async function markDone(lot) {
  
  // 1. Smooth fade-out animation
  const row = document.getElementById("row-" + lot);
  if (row) row.classList.add("fade-out");

  // 2. Call Apps Script to update FMS
  await fetch(`${API}?action=done&lot=${lot}`);

  // 3. Reload fresh data after animation
  setTimeout(loadData, 450);
}

// LIVE FILTERS
document.getElementById("searchLot").oninput = () => renderTable(fullData);
document.getElementById("filterParty").oninput = () => renderTable(fullData);
document.getElementById("filterColor").oninput = () => renderTable(fullData);

// START
loadData();

</script>

</body>
</html>
